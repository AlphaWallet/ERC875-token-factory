$(() => {
    let Web3 = require("web3");
    let web3 = new Web3(new Web3.providers.HttpProvider('http://localhost:8545'));
    let abi = require('./abi').abi;
    let shortAbi = require('./abi').shortABI;

    if (typeof window.web3 !== 'undefined')
    {
        web3 = new Web3(window.web3.currentProvider);
        console.log("injected provider used");
        web3.eth.defaultAccount = web3.eth.coinbase;
        try
        {
            window.web3.currentProvider.enable();
        }
        catch(e) {
            //do nothing, just don't halt the program
            console.log("backward incompatible web3 with privacy mode + " + e);
        }
    }
    else
    {
        alert("no injected provider found, using localhost:8545, please ensure your local node is running " +
            "and rpc and rpccorsdomain is enabled");
    }

    let tokens = [] /* let of type uint256[] here */ ;
    let nameOfContract = ""/* let of type string here */ ;
    let symbolForContract = "" /* let of type string here */ ;
    let organiserAddr = "" /* let of type address here */ ;
    let paymasterAddr = ""/* let of type address here */ ;
    let recipientAddr = "" /* let of type address here */ ;
    let state = "";
    let buildingName = "";
    let street = "";
    let erc875Contract = web3.eth.contract(abi);
    let contractAddr = "";
    let tokenVal = "0x00000000000000000000000000000000EF6351E10000000000000000F7";
    let locality = "";

    function init() 
    {
        let address = web3.eth.coinbase;
        nameOfContract = $("#eventName").val();
        symbolForContract = $("#tokenSymbol").val();
        organiserAddr = $("#ownerAddress").val();
        paymasterAddr = address;
        recipientAddr = $("#recipientAddress").val();
        state = $("#state").val();
        buildingName = $("#buildingInput").val();
        street = $("#streetInput").val();
        locality = $("#localityInput").val();
        let numberOfTokens = $("#numberOfTokens").val();
        if(numberOfTokens == "")
        {
            //default 20
            numberOfTokens = 20;
        }
        console.log("number of tokens: " + numberOfTokens);
        for(let i = 0; i < parseInt(numberOfTokens); i++)
        {
            tokens.push(tokenVal);
        }
        if(organiserAddr == "") organiserAddr = address;
        if(recipientAddr == "") recipientAddr = address;
        //once initialized, deploy
        deploy();
    }

    $("#deploy").click(() => 
    {
        init();
    });

    function deploy() {
        $("#notice").show(); //let the user know that the contract is being deployed
        web3.eth.getBlock("latest", (err, data) =>
        {
            let gasLimit = 471238800000; //geth default limit
            let gasPrice = 3000000000;
            if(!err)
            {
                gasLimit = data.gasLimit;
            }
            console.log("tokens: " + tokens);
            console.log("organiser: " + organiserAddr);
            console.log("pay: " + paymasterAddr);
            console.log("recipient: " + recipientAddr);
            console.log("building: " + buildingName);
            console.log("street: " + street);
            console.log("locality: " + locality);
            console.log("state: " + state);
            console.log("symbol: " + symbolForContract);
            console.log("name: " + nameOfContract);
            console.log("gas price: " + gasPrice);
            console.log("gas limit: " + gasLimit);

            erc875Contract.new(
                tokens,
                organiserAddr,
                paymasterAddr,
                recipientAddr,
                buildingName,
                street,
                locality,
                state,
                symbolForContract,
                nameOfContract,
                {
                    from: web3.eth.coinbase,
                    gas: '4700000',
                    data: '0x608060405260006005556000600760006101000a81548160ff02191690831515021790555060405180807f62616c616e63654f66286164647265737329000000000000000000000000000081525060120190506040518091039020600d60006101000a81548163ffffffff02191690837c01000000000000000000000000000000000000000000000000000000009004021790555060405180807f74726164652875696e743235362c75696e743235365b5d2c75696e74382c627981526020017f74657333322c6279746573333229000000000000000000000000000000000000815250602e0190506040518091039020600d60046101000a81548163ffffffff02191690837c01000000000000000000000000000000000000000000000000000000009004021790555060405180807f70617373546f2875696e743235362c75696e743235365b5d2c75696e74382c6281526020017f7974657333322c627974657333322c616464726573732900000000000000000081525060370190506040518091039020600d60086101000a81548163ffffffff02191690837c01000000000000000000000000000000000000000000000000000000009004021790555060405180807f737061776e50617373546f2875696e743235362c75696e743235365b5d2c756981526020017f6e74382c627974657333322c627974657333322c616464726573732900000000815250603c0190506040518091039020600d600c6101000a81548163ffffffff02191690837c0100000000000000000000000000000000000000000000000000000000900402179055503480156200026357600080fd5b5060405162003e4f38038062003e4f8339810180604052810190808051820192919060200180519060200190929190805190602001909291908051906020019092919080518201929190602001805182019291906020018051820192919060200180518201929190602001805182019291906020018051820192919050505088600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555087600460006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550896000808973ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000209080519060200190620003b89291906200045f565b5085600b9080519060200190620003d1929190620004b1565b5084600a9080519060200190620003ea929190620004b1565b50836009908051906020019062000403929190620004b1565b5082600890805190602001906200041c929190620004b1565b5081600c908051906020019062000435929190620004b1565b5080600690805190602001906200044e929190620004b1565b505050505050505050505062000560565b8280548282559060005260206000209081019282156200049e579160200282015b828111156200049d57825182559160200191906001019062000480565b5b509050620004ad919062000538565b5090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10620004f457805160ff191683800117855562000525565b8280016001018555821562000525579182015b828111156200052457825182559160200191906001019062000507565b5b50905062000534919062000538565b5090565b6200055d91905b80821115620005595760008160009055506001016200053f565b5090565b90565b6138df80620005706000396000f3006080604052600436106101c2576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063015a0488146101c757806301ffc9a71461028057806302218bc5146102e457806306fdde031461038a578063139cea1c1461041a57806315070401146104c057806316e4cbf9146105505780631bb75082146105a75780632b4e4e96146105ec5780633095c1ad14610672578063313ce567146106b357806331bfee0a146106e457806340c1b7ad1461073b57806344c9af28146107e157806348dec51d146108875780634bd13cdd146109ac5780634f452b9a14610a5857806370a0823114610a8757806372c5cb6314610b1f5780637419662614610b4a5780637a23079114610bda5780637e53748614610c665780637f9f7f3d14610cbd57806395d89b4114610d4d578063a75186c714610ddd578063aba7786b14610f02578063b961de4414610f74578063bb6e7de914611099578063c19d93fb146110b0578063c9116b6914611140578063cf0b41a3146111ac578063d9548e5314611212578063e7dc333614611257578063f0141d84146112e7578063f6be7ed314611312578063fe60ebdc14611437575b600080fd5b3480156101d357600080fd5b5061027e6004803603810190808035906020019092919080359060200190820180359060200190808060200260200160405190810160405280939291908181526020018383602002808284378201915050505050509192919290803560ff16906020019092919080356000191690602001909291908035600019169060200190929190803573ffffffffffffffffffffffffffffffffffffffff1690602001909291905050506114dd565b005b34801561028c57600080fd5b506102ca60048036038101908080357bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19169060200190929190505050611865565b604051808215151515815260200191505060405180910390f35b3480156102f057600080fd5b5061030f60048036038101908080359060200190929190505050611a44565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561034f578082015181840152602081019050610334565b50505050905090810190601f16801561037c5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561039657600080fd5b5061039f611ae8565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156103df5780820151818401526020810190506103c4565b50505050905090810190601f16801561040c5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561042657600080fd5b5061044560048036038101908080359060200190929190505050611b8a565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561048557808201518184015260208101905061046a565b50505050905090810190601f1680156104b25780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3480156104cc57600080fd5b506104d5611c2e565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156105155780820151818401526020810190506104fa565b50505050905090810190601f1680156105425780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561055c57600080fd5b50610565611cd0565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b3480156105b357600080fd5b506105d260048036038101908080359060200190929190505050611cf6565b604051808215151515815260200191505060405180910390f35b3480156105f857600080fd5b50610670600480360381019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190820180359060200190808060200260200160405190810160405280939291908181526020018383602002808284378201915050505050509192919290505050611d4d565b005b34801561067e57600080fd5b5061069d60048036038101908080359060200190929190505050611f55565b6040518082815260200191505060405180910390f35b3480156106bf57600080fd5b506106c8611f78565b604051808260ff1660ff16815260200191505060405180910390f35b3480156106f057600080fd5b506106f9611f7d565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561074757600080fd5b5061076660048036038101908080359060200190929190505050611f85565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156107a657808201518184015260208101905061078b565b50505050905090810190601f1680156107d35780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3480156107ed57600080fd5b5061080c60048036038101908080359060200190929190505050612029565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561084c578082015181840152602081019050610831565b50505050905090810190601f1680156108795780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561089357600080fd5b5061093160048036038101908080359060200190820180359060200190808060200260200160405190810160405280939291908181526020018383602002808284378201915050505050509192919290803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091929192905050506120cd565b6040518080602001828103825283818151815260200191508051906020019080838360005b83811015610971578082015181840152602081019050610956565b50505050905090810190601f16801561099e5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b610a566004803603810190808035906020019092919080359060200190820180359060200190808060200260200160405190810160405280939291908181526020018383602002808284378201915050505050509192919290803560ff16906020019092919080356000191690602001909291908035600019169060200190929190803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050612148565b005b348015610a6457600080fd5b50610a6d612405565b604051808215151515815260200191505060405180910390f35b348015610a9357600080fd5b50610ac8600480360381019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919050505061240e565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b83811015610b0b578082015181840152602081019050610af0565b505050509050019250505060405180910390f35b348015610b2b57600080fd5b50610b346124a4565b6040518082815260200191505060405180910390f35b348015610b5657600080fd5b50610b5f6124ae565b6040518080602001828103825283818151815260200191508051906020019080838360005b83811015610b9f578082015181840152602081019050610b84565b50505050905090810190601f168015610bcc5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b610c646004803603810190808035906020019092919080359060200190820180359060200190808060200260200160405190810160405280939291908181526020018383602002808284378201915050505050509192919290803560ff1690602001909291908035600019169060200190929190803560001916906020019092919050505061254c565b005b348015610c7257600080fd5b50610c7b6128b7565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b348015610cc957600080fd5b50610cd26128dd565b6040518080602001828103825283818151815260200191508051906020019080838360005b83811015610d12578082015181840152602081019050610cf7565b50505050905090810190601f168015610d3f5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b348015610d5957600080fd5b50610d6261297b565b6040518080602001828103825283818151815260200191508051906020019080838360005b83811015610da2578082015181840152602081019050610d87565b50505050905090810190601f168015610dcf5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b348015610de957600080fd5b50610e8760048036038101908080359060200190820180359060200190808060200260200160405190810160405280939291908181526020018383602002808284378201915050505050509192919290803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290505050612a19565b6040518080602001828103825283818151815260200191508051906020019080838360005b83811015610ec7578082015181840152602081019050610eac565b50505050905090810190601f168015610ef45780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b348015610f0e57600080fd5b50610f7260048036038101908080359060200190820180359060200190808060200260200160405190810160405280939291908181526020018383602002808284378201915050505050509192919290803515159060200190929190505050612a94565b005b348015610f8057600080fd5b5061101e60048036038101908080359060200190820180359060200190808060200260200160405190810160405280939291908181526020018383602002808284378201915050505050509192919290803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290505050612b0e565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561105e578082015181840152602081019050611043565b50505050905090810190601f16801561108b5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3480156110a557600080fd5b506110ae612b89565b005b3480156110bc57600080fd5b506110c5612c20565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156111055780820151818401526020810190506110ea565b50505050905090810190601f1680156111325780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561114c57600080fd5b50611155612cbe565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b8381101561119857808201518184015260208101905061117d565b505050509050019250505060405180910390f35b3480156111b857600080fd5b5061121060048036038101908080359060200190820180359060200190808060200260200160405190810160405280939291908181526020018383602002808284378201915050505050509192919290505050612d52565b005b34801561121e57600080fd5b5061123d60048036038101908080359060200190929190505050612e70565b604051808215151515815260200191505060405180910390f35b34801561126357600080fd5b5061126c612e89565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156112ac578082015181840152602081019050611291565b50505050905090810190601f1680156112d95780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3480156112f357600080fd5b506112fc612f27565b6040518082815260200191505060405180910390f35b34801561131e57600080fd5b506113bc60048036038101908080359060200190820180359060200190808060200260200160405190810160405280939291908181526020018383602002808284378201915050505050509192919290803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290505050612f32565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156113fc5780820151818401526020810190506113e1565b50505050905090810190601f1680156114295780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561144357600080fd5b506114db600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190820180359060200190808060200260200160405190810160405280939291908181526020018383602002808284378201915050505050509192919290505050612fad565b005b6000806000806000600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561154157600080fd5b428b118061154f575060008b145b151561155a57600080fd5b61156660008c8c613229565b94506001858a8a8a604051600081526020016040526040518085600019166000191681526020018460ff1660ff1681526020018360001916600019168152602001826000191660001916815260200194505050505060206040516020810390808403906000865af11580156115df573d6000803e3d6000fd5b505050602060405103519350600092505b895183101561179b57898381518110151561160757fe5b90602001906020020151915060008060008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208381548110151561166057fe5b90600052602060002001541415151561167557fe5b6000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020828154811015156116c057fe5b906000526020600020015490506000808773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190806001815401808255809150509060018203906000526020600020016000909192909190915055506000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208281548110151561178057fe5b906000526020600020016000905582806001019350506115f0565b8573ffffffffffffffffffffffffffffffffffffffff167fcf7370598f037d339864eec2202ca184ad6af5b4a0f56335d83f97ed76bafcc08b8b8b8b60405180806020018560ff1660ff16815260200184600019166000191681526020018360001916600019168152602001828103825286818151815260200191508051906020019060200280838360005b83811015611842578082015181840152602081019050611827565b505050509050019550505050505060405180910390a25050505050505050505050565b6000600d60009054906101000a90047c0100000000000000000000000000000000000000000000000000000000027bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff191614806119465750600d60049054906101000a90047c0100000000000000000000000000000000000000000000000000000000027bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916145b806119b95750600d60089054906101000a90047c0100000000000000000000000000000000000000000000000000000000027bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916145b80611a2c5750600d600c9054906101000a90047c0100000000000000000000000000000000000000000000000000000000027bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916145b15611a3a5760019050611a3f565b600090505b919050565b606060098054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015611adc5780601f10611ab157610100808354040283529160200191611adc565b820191906000526020600020905b815481529060010190602001808311611abf57829003601f168201915b50505050509050919050565b606060068054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015611b805780601f10611b5557610100808354040283529160200191611b80565b820191906000526020600020905b815481529060010190602001808311611b6357829003601f168201915b5050505050905090565b6060600b8054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015611c225780601f10611bf757610100808354040283529160200191611c22565b820191906000526020600020905b815481529060010190602001808311611c0557829003601f168201915b50505050509050919050565b6060600c8054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015611cc65780601f10611c9b57610100808354040283529160200191611cc6565b820191906000526020600020905b815481529060010190602001808311611ca957829003601f168201915b5050505050905090565b600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600080600090505b600180549050811015611d425782600182815481101515611d1b57fe5b90600052602060002001541415611d355760019150611d47565b8080600101915050611cfe565b600091505b50919050565b600080600091505b8251821015611f00578282815181101515611d6c57fe5b90602001906020020151905060008060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002082815481101515611dc557fe5b906000526020600020015414151515611ddd57600080fd5b6000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002082815481101515611e6657fe5b906000526020600020015490806001815401808255809150509060018203906000526020600020016000909192909190915055506000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081815481101515611ee557fe5b90600052602060002001600090558180600101925050611d55565b8373ffffffffffffffffffffffffffffffffffffffff167f69ca02dd4edd7bf0a4abb9ed3b7af3f14778db5d61921c7dc7cd545266326de284516040518082815260200191505060405180910390a250505050565b600181815481101515611f6457fe5b906000526020600020016000915090505481565b600081565b600030905090565b6060600a8054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561201d5780601f10611ff25761010080835404028352916020019161201d565b820191906000526020600020905b81548152906001019060200180831161200057829003601f168201915b50505050509050919050565b606060088054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156120c15780601f10612096576101008083540402835291602001916120c1565b820191906000526020600020905b8154815290600101906020018083116120a457829003601f168201915b50505050509050919050565b6060600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561212b57600080fd5b816009908051906020019061214192919061380e565b5092915050565b60008060004289118061215b5750600089145b151561216657600080fd5b612171348a8a61355b565b9250600183888888604051600081526020016040526040518085600019166000191681526020018460ff1660ff1681526020018360001916600019168152602001826000191660001916815260200194505050505060206040516020810390808403906000865af11580156121ea573d6000803e3d6000fd5b505050602060405103519150600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1614151561225257600080fd5b60026000866000191660001916815260200190815260200160002060009054906101000a900460ff1615151561228757600080fd5b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc349081150290604051600060405180830381858888f193505050501580156122ef573d6000803e3d6000fd5b50600090505b87518110156123fa5760001515612322898381518110151561231357fe5b90602001906020020151611cf6565b151514156123ed576000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020888281518110151561237657fe5b906020019060200201519080600181540180825580915050906001820390600052602060002001600090919290919091505550600188828151811015156123b957fe5b9060200190602002015190806001815401808255809150509060018203906000526020600020016000909192909190915055505b80806001019150506122f5565b505050505050505050565b60006001905090565b60606000808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002080548060200260200160405190810160405280929190818152602001828054801561249857602002820191906000526020600020905b815481526020019060010190808311612484575b50505050509050919050565b6000600554905090565b600a8054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156125445780601f1061251957610100808354040283529160200191612544565b820191906000526020600020905b81548152906001019060200180831161252757829003601f168201915b505050505081565b600080600080428911806125605750600089145b151561256b57600080fd5b612576348a8a613229565b9350600184888888604051600081526020016040526040518085600019166000191681526020018460ff1660ff1681526020018360001916600019168152602001826000191660001916815260200194505050505060206040516020810390808403906000865af11580156125ef573d6000803e3d6000fd5b505050602060405103519250600091505b87518210156127a857878281518110151561261757fe5b90602001906020020151905060008060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208281548110151561267057fe5b90600052602060002001541415151561268557fe5b6000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208281548110151561270e57fe5b906000526020600020015490806001815401808255809150509060018203906000526020600020016000909192909190915055506000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208181548110151561278d57fe5b90600052602060002001600090558180600101925050612600565b8273ffffffffffffffffffffffffffffffffffffffff166108fc349081150290604051600060405180830381858888f193505050501580156127ee573d6000803e3d6000fd5b508273ffffffffffffffffffffffffffffffffffffffff167f951553379d49c26bc057f41de147adc24a09bda33b6b23374354bfbfb96edae88989898960405180806020018560ff1660ff16815260200184600019166000191681526020018360001916600019168152602001828103825286818151815260200191508051906020019060200280838360005b8381101561289657808201518184015260208101905061287b565b505050509050019550505050505060405180910390a2505050505050505050565b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60098054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156129735780601f1061294857610100808354040283529160200191612973565b820191906000526020600020905b81548152906001019060200180831161295657829003601f168201915b505050505081565b600c8054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015612a115780601f106129e657610100808354040283529160200191612a11565b820191906000526020600020905b8154815290600101906020018083116129f457829003601f168201915b505050505081565b6060600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515612a7757600080fd5b8160089080519060200190612a8d92919061380e565b5092915050565b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515612af057600080fd5b80600760006101000a81548160ff0219169083151502179055505050565b6060600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515612b6c57600080fd5b81600b9080519060200190612b8292919061380e565b5092915050565b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515612be557600080fd5b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b60088054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015612cb65780601f10612c8b57610100808354040283529160200191612cb6565b820191906000526020600020905b815481529060010190602001808311612c9957829003601f168201915b505050505081565b60606000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020805480602002602001604051908101604052809291908181526020018280548015612d4857602002820191906000526020600020905b815481526020019060010190808311612d34575b5050505050905090565b6000600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515612db057600080fd5b600090505b8151811015612e6c57600080600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208282815181101515612e2c57fe5b9060200190602002015190806001815401808255809150509060018203906000526020600020016000909192909190915055508080600101915050612db5565b5050565b6000600760009054906101000a900460ff169050919050565b600b8054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015612f1f5780601f10612ef457610100808354040283529160200191612f1f565b820191906000526020600020905b815481529060010190602001808311612f0257829003601f168201915b505050505081565b60008060ff16905090565b6060600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515612f9057600080fd5b81600a9080519060200190612fa692919061380e565b5092915050565b600080600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561300c57600080fd5b600091505b82518210156131bc57828281518110151561302857fe5b90602001906020020151905060008060008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208281548110151561308157fe5b90600052602060002001541415151561309957600080fd5b6000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208281548110151561312257fe5b906000526020600020015490806001815401808255809150509060018203906000526020600020016000909192909190915055506000808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020818154811015156131a157fe5b90600052602060002001600090558180600101925050613011565b8373ffffffffffffffffffffffffffffffffffffffff168573ffffffffffffffffffffffffffffffffffffffff167fc0d84ce5c7ff9ca21adb0f8436ff3f4951b4bb78c4e2fae2b6837958b3946ffd85516040518082815260200191505060405180910390a35050505050565b6000606060008060028551026054016040519080825280601f01601f19166020018201604052801561326a5781602001602082028038833980820191505090505b509250613275611f7d565b9150600090505b60208110156132dd5780600802879060020a0260010283828151811015156132a057fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a905350808060010191505061327c565b600090505b60208110156133465780600802869060020a02600102836020830181518110151561330957fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a90535080806001019150506132e2565b600090505b60148110156133ca5780600802826c01000000000000000000000000026bffffffffffffffffffffffff19169060020a02838260400181518110151561338d57fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a905350808060010191505061334b565b600090505b84518110156134ec57600885828151811015156133e857fe5b906020019060200201519060020a90047f010000000000000000000000000000000000000000000000000000000000000002836002830260540181518110151561342e57fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a905350848181518110151561346c57fe5b906020019060200201517f01000000000000000000000000000000000000000000000000000000000000000283600160028402605401018151811015156134af57fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a90535080806001019150506133cf565b826040518082805190602001908083835b60208310151561352257805182526020820191506020810190506020830392506134fd565b6001836020036101000a038019825116818451168082178552505050505050905001915050604051809103902093505050509392505050565b60006060600080600060208651026054016040519080825280601f01601f19166020018201604052801561359e5781602001602082028038833980820191505090505b5093506135a9611f7d565b9250600091505b60208210156136115781600802889060020a0260010284838151811015156135d457fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a90535081806001019250506135b0565b600091505b602082101561367a5781600802879060020a02600102846020840181518110151561363d57fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508180600101925050613616565b600091505b60148210156136fe5781600802836c01000000000000000000000000026bffffffffffffffffffffffff19169060020a0284836040018151811015156136c157fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a905350818060010192505061367f565b600091505b855182101561379e57600090505b60208110156137915780600802868381518110151561372c57fe5b906020019060200201519060020a026001028482602085026054010181518110151561375457fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508080600101915050613711565b8180600101925050613703565b836040518082805190602001908083835b6020831015156137d457805182526020820191506020810190506020830392506137af565b6001836020036101000a03801982511681845116808217855250505050505090500191505060405180910390209450505050509392505050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061384f57805160ff191683800117855561387d565b8280016001018555821561387d579182015b8281111561387c578251825591602001919060010190613861565b5b50905061388a919061388e565b5090565b6138b091905b808211156138ac576000816000905550600101613894565b5090565b905600a165627a7a72305820ba12ebabe16dfe9671d8f5865641211d4b7de81300e95b41d840ffbe1480f7b40029'
                }, function (e, contract){
                    console.log(e, contract);
                    if (e) {
                        alert(e);
                        return;
                    }
                    if (typeof contract.address !== 'undefined')
                    {
                        contractAddr = contract.address;
                        alert('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
                        //set xcontract button
                        $("#viewOnXContract").show().click(() =>
                        {
                            window.location.href = "https://xcontract.herokuapp.com/api/" + JSON.stringify(shortAbi) + "/" + contract.address
                        });
                        $("#viewOnEtherscan").show().click(() => {
                            redirectToEtherscan(contract.address);
                        });
                        $("#addMoreTokens").show();
                        $("#addMoreTokensButton").show();
                        $("#addMoreTokensLabel").show();
                    }
                });
        });
    }

    $("#addMoreTokensButton").click(() =>
    {
        let contract = erc875Contract.at(contractAddr);
        let tokens = $("#addMoreTokens").val();
        let tokensToAdd = [];
        for(let i = 0; i < tokens; i++)
        {
            tokensToAdd.push(tokenVal);
        }
        contract.loadNewTickets.sendTransaction(tokensToAdd, (err, data) =>
        {
            if(err)
            {
                alert(err);
            }
            else
            {
                alert("Tx submitted: " + data);
            }
        })
    });

    function redirectToEtherscan(address)
    {
        web3.version.getNetwork((err, networkId) => {
            if (networkId == 3) window.location.href = "https://ropsten.etherscan.io/address/" + address;
            else if (networkId == 4) window.location.href = "https://rinkeby.etherscan.io/address/" + address;
            else if (networkId == 42) window.location.href = "https://kovan.etherscan.io/address/" + address;
            else window.location.href = "https://etherscan.io/address/" + address;
        });
    }

});
